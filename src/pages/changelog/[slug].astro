---
import { getCollection, getEntry } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import Text from "@/components/fundations/typography/Text.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
import Kicker from "@/components/fundations/typography/Kicker.astro";
export async function getStaticPaths() {
  const entries = await getCollection("changelog");
  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}
// For SSR mode, also try to get the entry directly
const { slug } = Astro.params;
let entry = Astro.props.entry;
// If entry is not in props (SSR mode), fetch it
if (!entry && slug) {
  entry = await getEntry("changelog", slug);
}
// Safety check
if (!entry) {
  return Astro.redirect("/changelog");
}
const { Content } = await entry.render();
// Format date
const dateObj = new Date(entry.data.date);
const formattedDate = `${dateObj.toLocaleDateString("en-US", { weekday: "short" })}, ${dateObj.getDate()} of ${dateObj.toLocaleDateString("en-US", { month: "short" })}, ${dateObj.getFullYear()}`;
// Breadcrumbs Data
import ChevronRight from "@/components/fundations/icons/ChevronRight.astro";

const breadcrumbs = [
  { label: "Home", href: "/" },
  { label: "Changelog", href: "/changelog" },
  { label: entry.data.title, href: "#" },
];
---

<BaseLayout>
  <Wrapper
    variant="standard"
    class="pt-32 pb-12 border-b border-base-200 dark:border-base-800"
  >
    <Wrapper variant="narrow">
      <nav aria-label="Breadcrumb">
        <ol class="flex items-center text-xs gap-x-1 text-base-400">
          {
            breadcrumbs.map((item, index) => (
              <>
                <li class="max-w-xs font-medium">
                  {index < breadcrumbs.length - 1 ? (
                    <a
                      href={item.href}
                      class=" hover:text-secondary-300 truncate block"
                    >
                      {item.label}
                    </a>
                  ) : (
                    <span class=" text-secondary-500 truncate block">
                      {item.label}
                    </span>
                  )}
                </li>
                {index < breadcrumbs.length - 1 && (
                  <li class="text-base-400 flex-shrink-0">
                    <ChevronRight size="xs" />
                  </li>
                )}
              </>
            ))
          }
        </ol>
      </nav>
      <Text
        tag="h1"
        variant="displayMD"
        class="mt-12 text-base-900 dark:text-white"
      >
        {entry.data.title}
      </Text>
      <Text variant="textBase" class="mt-4 text-base-500">
        <time datetime={formattedDate}>{formattedDate}</time>
      </Text>
      <div class={`aspect-12/4 p-4 mt-8 -mx-px ${entry.data.bgColor} h-full `}>
      </div>
      <Wrapper variant="prose" class="mt-8">
        <Content />
      </Wrapper>
    </Wrapper>
  </Wrapper>
</BaseLayout>
